<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Events - ALUMNETICS</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body style="font-family: 'Inter', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh;">
    
    <!-- Header -->
    <header style="background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); border-bottom: 1px solid rgba(255,255,255,0.2); position: sticky; top: 0; z-index: 50;">
        <div style="max-width: 1280px; margin: 0 auto; padding: 1rem 2rem;">
            <div style="display: flex; align-items: center; justify-content: space-between;">
                <div>
                    <h1 style="font-size: 1.5rem; font-weight: bold; color: white;"> Events Hub</h1>
                    <p style="color: rgba(255,255,255,0.8); font-size: 0.875rem;">Discover and join alumni events</p>
                </div>
                <button onclick="window.history.back()" style="padding: 0.5rem 1rem; background: rgba(255,255,255,0.2); color: white; border: none; border-radius: 0.5rem; font-weight: 500; cursor: pointer;">
                     Back to Dashboard
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main style="max-width: 1280px; margin: 0 auto; padding: 2rem;">
        
        <!-- Search and Filters -->
        <div style="background: rgba(255,255,255,0.9); backdrop-filter: blur(10px); border-radius: 1rem; box-shadow: 0 10px 40px rgba(0,0,0,0.1); padding: 1.5rem; margin-bottom: 2rem;">
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem;">
                <input 
                    type="text" 
                    id="searchInput"
                    placeholder="Search events..." 
                    style="padding: 0.75rem 1rem; border: 2px solid #e5e7eb; border-radius: 0.75rem; outline: none;"
                >
                <select 
                    id="typeFilter"
                    style="padding: 0.75rem 1rem; border: 2px solid #e5e7eb; border-radius: 0.75rem; outline: none;"
                >
                    <option value="">All Types</option>
                    <option value="webinar">Webinar</option>
                    <option value="workshop">Workshop</option>
                    <option value="meetup">Meetup</option>
                    <option value="reunion">Reunion</option>
                    <option value="hackathon">Hackathon</option>
                    <option value="career">Career Fair</option>
                    <option value="conference">Conference</option>
                    <option value="seminar">Seminar</option>
                </select>
                <button 
                    onclick="loadEvents()"
                    style="padding: 0.75rem 1rem; background: linear-gradient(to right, #9333ea, #4f46e5); color: white; border: none; border-radius: 0.75rem; font-weight: 500; cursor: pointer;"
                >
                     Search
                </button>
            </div>
        </div>

        <!-- Loading State -->
        <div id="loadingState" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem;">
            <div style="background: #f3f4f6; height: 400px; border-radius: 1rem;"></div>
            <div style="background: #f3f4f6; height: 400px; border-radius: 1rem;"></div>
            <div style="background: #f3f4f6; height: 400px; border-radius: 1rem;"></div>
        </div>

        <!-- Events Grid -->
        <div id="eventsGrid" style="display: none; grid-template-columns: repeat(3, 1fr); gap: 1.5rem;">
        </div>

        <!-- Empty State -->
        <div id="emptyState" style="display: none; text-align: center; padding: 4rem;">
            <div style="font-size: 4rem; margin-bottom: 1rem;"></div>
            <h3 style="font-size: 1.25rem; font-weight: 600; color: white; margin-bottom: 0.5rem;">No Events Found</h3>
            <p style="color: rgba(255,255,255,0.8);">Check back later for upcoming events!</p>
        </div>
    </main>

    <!-- Event Modal -->
    <div id="eventModal" style="display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 100; justify-content: center; align-items: center; padding: 1rem;">
        <div style="background: white; border-radius: 1rem; max-width: 600px; width: 100%; max-height: 90vh; overflow-y: auto;">
            <div id="modalContent"></div>
        </div>
    </div>

    <script src="../../assets/js/config.js"></script>
    <script src="../../assets/js/api-service.js"></script>
    <script src="../../assets/js/utils.js"></script>
    
    <script>
        let allEvents = [];
        
        async function loadEvents() {
            const loadingState = document.getElementById('loadingState');
            const eventsGrid = document.getElementById('eventsGrid');
            const emptyState = document.getElementById('emptyState');
            
            try {
                console.log(' Loading events...');
                loadingState.style.display = 'grid';
                eventsGrid.style.display = 'none';
                emptyState.style.display = 'none';
                
                const searchTerm = document.getElementById('searchInput').value;
                const typeFilter = document.getElementById('typeFilter').value;
                
                const params = {};
                if (searchTerm) params.search = searchTerm;
                if (typeFilter) params.type = typeFilter;
                
                const response = await window.AlumNeticsAPI.getEvents(params);
                console.log(' Response:', response);
                
                loadingState.style.display = 'none';
                
                if (response && response.success && response.data) {
                    let events = Array.isArray(response.data) ? response.data : response.data.events || [];
                    allEvents = events;
                    console.log(' Loaded ' + events.length + ' events');
                    
                    if (events.length > 0) {
                        displayEvents(events);
                    } else {
                        emptyState.style.display = 'block';
                    }
                } else {
                    emptyState.style.display = 'block';
                }
            } catch (error) {
                console.error(' Error:', error);
                loadingState.style.display = 'none';
                emptyState.style.display = 'block';
            }
        }
        
        function displayEvents(events) {
            const grid = document.getElementById('eventsGrid');
            grid.innerHTML = '';
            grid.style.display = 'grid';
            
            // Default images by event type
            const defaultImages = {
                'reunion': 'https://images.unsplash.com/photo-1523580494863-6f3031224c94?w=400&h=200&fit=crop',
                'networking': 'https://images.unsplash.com/photo-1511578314322-379afb476865?w=400&h=200&fit=crop',
                'workshop': 'https://images.unsplash.com/photo-1522071820081-009f0129c71c?w=400&h=200&fit=crop',
                'seminar': 'https://images.unsplash.com/photo-1540575467063-178a50c2df87?w=400&h=200&fit=crop',
                'career-fair': 'https://images.unsplash.com/photo-1521737711867-e3b97375f902?w=400&h=200&fit=crop',
                'fundraising': 'https://images.unsplash.com/photo-1559027615-cd4628902d4a?w=400&h=200&fit=crop',
                'social': 'https://images.unsplash.com/photo-1511795409834-ef04bbd61622?w=400&h=200&fit=crop',
                'other': 'https://images.unsplash.com/photo-1505373877841-8d25f7d46678?w=400&h=200&fit=crop'
            };
            
            events.forEach(event => {
                const card = document.createElement('div');
                card.style.cssText = 'background: white; border-radius: 1rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); overflow: hidden; cursor: pointer; transition: transform 0.3s;';
                card.onmouseover = () => card.style.transform = 'translateY(-5px)';
                card.onmouseout = () => card.style.transform = 'translateY(0)';
                card.onclick = () => showModal(event);
                
                const date = new Date(event.startDate);
                const dateStr = date.toLocaleDateString();
                const timeStr = date.toLocaleTimeString();
                
                // Get event image - check for valid image URL
                let eventImage = null;
                if (event.coverImage && typeof event.coverImage === 'object' && event.coverImage.url) {
                    eventImage = event.coverImage.url;
                } else if (event.coverImage && typeof event.coverImage === 'string' && event.coverImage.trim()) {
                    eventImage = event.coverImage;
                } else if (event.imageUrl && typeof event.imageUrl === 'string' && event.imageUrl.trim()) {
                    eventImage = event.imageUrl;
                }
                
                // Use default image if no image found
                if (!eventImage) {
                    eventImage = defaultImages[event.eventType] || defaultImages['other'];
                }
                
                card.innerHTML = '<div style="height: 200px; background: linear-gradient(to right, #9333ea, #4f46e5); position: relative;">' +
                    '<img src="' + eventImage + '" style="width: 100%; height: 100%; object-fit: cover;" onerror="this.src=\'' + defaultImages['other'] + '\'">' +
                    '<div style="position: absolute; bottom: 1rem; left: 1rem; color: white;"><h3 style="font-size: 1.25rem; font-weight: bold;">' + event.title + '</h3></div>' +
                    '</div>' +
                    '<div style="padding: 1.25rem;">' +
                    '<p style="color: #6b7280; font-size: 0.875rem; margin-bottom: 1rem;">' + (event.description || '').substring(0, 100) + '...</p>' +
                    '<div style="display: flex; justify-content: space-between; align-items: center;">' +
                    '<span style="font-size: 0.875rem; color: #6b7280;"> ' + (event.attendees?.length || 0) + ' registered</span>' +
                    '<button onclick="event.stopPropagation(); registerEvent(\'' + event._id + '\')" style="padding: 0.5rem 1rem; background: linear-gradient(to right, #9333ea, #4f46e5); color: white; border: none; border-radius: 0.5rem; cursor: pointer;">Register</button>' +
                    '</div></div>';
                
                grid.appendChild(card);
            });
        }
        
        function showModal(event) {
            const modal = document.getElementById('eventModal');
            const content = document.getElementById('modalContent');
            
            const date = new Date(event.startDate);
            
            // Default images by event type
            const defaultImages = {
                'reunion': 'https://images.unsplash.com/photo-1523580494863-6f3031224c94?w=800&h=400&fit=crop',
                'networking': 'https://images.unsplash.com/photo-1511578314322-379afb476865?w=800&h=400&fit=crop',
                'workshop': 'https://images.unsplash.com/photo-1522071820081-009f0129c71c?w=800&h=400&fit=crop',
                'seminar': 'https://images.unsplash.com/photo-1540575467063-178a50c2df87?w=800&h=400&fit=crop',
                'career-fair': 'https://images.unsplash.com/photo-1521737711867-e3b97375f902?w=800&h=400&fit=crop',
                'fundraising': 'https://images.unsplash.com/photo-1559027615-cd4628902d4a?w=800&h=400&fit=crop',
                'social': 'https://images.unsplash.com/photo-1511795409834-ef04bbd61622?w=800&h=400&fit=crop',
                'other': 'https://images.unsplash.com/photo-1505373877841-8d25f7d46678?w=800&h=400&fit=crop'
            };
            
            // Get event image
            let eventImage = null;
            if (event.coverImage && typeof event.coverImage === 'object' && event.coverImage.url) {
                eventImage = event.coverImage.url;
            } else if (event.coverImage && typeof event.coverImage === 'string' && event.coverImage.trim()) {
                eventImage = event.coverImage;
            } else if (event.imageUrl && typeof event.imageUrl === 'string' && event.imageUrl.trim()) {
                eventImage = event.imageUrl;
            }
            
            // Use default image if no image found
            if (!eventImage) {
                eventImage = defaultImages[event.eventType] || defaultImages['other'];
            }
            
            content.innerHTML = '<div style="position: relative;">' +
                '<img src="' + eventImage + '" style="width: 100%; height: 250px; object-fit: cover; border-radius: 1rem 1rem 0 0;" onerror="this.src=\'' + defaultImages['other'] + '\'">' +
                '<button onclick="closeModal()" style="position: absolute; top: 1rem; right: 1rem; width: 40px; height: 40px; background: white; border: none; border-radius: 50%; cursor: pointer; font-size: 1.25rem;"></button>' +
                '</div>' +
                '<div style="padding: 1.5rem;">' +
                '<h2 style="font-size: 1.5rem; font-weight: bold; margin-bottom: 1rem;">' + event.title + '</h2>' +
                '<p style="color: #6b7280; margin-bottom: 1rem;"> ' + date.toLocaleDateString() + '  ' + date.toLocaleTimeString() + '</p>' +
                '<p style="color: #6b7280; margin-bottom: 1rem;">' + (event.description || 'No description') + '</p>' +
                '<p style="color: #6b7280; margin-bottom: 1.5rem;"> ' + (event.attendees?.length || 0) + ' registered</p>' +
                '<div style="display: flex; gap: 1rem;">' +
                '<button onclick="registerEvent(\'' + event._id + '\')" style="flex: 1; padding: 0.75rem; background: linear-gradient(to right, #9333ea, #4f46e5); color: white; border: none; border-radius: 0.75rem; cursor: pointer; font-weight: 500;">Register</button>' +
                '<button onclick="closeModal()" style="padding: 0.75rem 1.5rem; border: 2px solid #e5e7eb; background: white; border-radius: 0.75rem; cursor: pointer;">Close</button>' +
                '</div></div>';
            
            modal.style.display = 'flex';
        }
        
        function closeModal() {
            document.getElementById('eventModal').style.display = 'none';
        }
        
        async function registerEvent(id) {
            try {
                const response = await window.AlumNeticsAPI.registerForEvent(id);
                if (response && response.success) {
                    alert(' Successfully registered!');
                    closeModal();
                    loadEvents();
                }
            } catch (error) {
                alert(' Registration failed: ' + error.message);
            }
        }
        
        document.getElementById('eventModal').onclick = function(e) {
            if (e.target === this) closeModal();
        };
        
        document.getElementById('searchInput').onkeypress = function(e) {
            if (e.key === 'Enter') loadEvents();
        };
        
        window.addEventListener('DOMContentLoaded', function() {
            console.log(' Events page loaded');
            loadEvents();
        });
    </script>
</body>
</html>
