<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View Profile - ALUMNETICS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
        
        body { 
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        /* Animated background patterns */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(102, 126, 234, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(118, 75, 162, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(255, 255, 255, 0.1) 0%, transparent 40%);
            z-index: 0;
            animation: breathe 8s ease-in-out infinite;
        }

        @keyframes breathe {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        /* Floating particles */
        .particle {
            position: fixed;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 50%;
            pointer-events: none;
            animation: float 15s infinite ease-in-out;
        }

        .particle:nth-child(1) {
            width: 80px;
            height: 80px;
            top: 10%;
            left: 10%;
            animation-delay: 0s;
        }

        .particle:nth-child(2) {
            width: 60px;
            height: 60px;
            top: 60%;
            right: 15%;
            animation-delay: -5s;
        }

        .particle:nth-child(3) {
            width: 100px;
            height: 100px;
            bottom: 10%;
            left: 70%;
            animation-delay: -10s;
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0px) rotate(0deg);
                opacity: 0.3;
            }
            50% {
                transform: translateY(-30px) rotate(180deg);
                opacity: 0.8;
            }
        }

        /* Glass morphism effect */
        .glass {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 
                0 8px 32px 0 rgba(31, 38, 135, 0.15),
                inset 0 1px 0 0 rgba(255, 255, 255, 0.5);
        }

        /* Card hover effects */
        .hover-lift {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .hover-lift:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.2),
                0 0 0 1px rgba(255, 255, 255, 0.1);
        }

        /* Gradient text */
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Shimmer effect for loading */
        @keyframes shimmer {
            0% { background-position: -1000px 0; }
            100% { background-position: 1000px 0; }
        }

        .shimmer {
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.8), transparent);
            background-size: 1000px 100%;
            animation: shimmer 2s infinite;
        }

        /* Smooth scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 10px;
        }

        /* Badge animations */
        .badge-float {
            animation: badgeFloat 3s ease-in-out infinite;
        }

        @keyframes badgeFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
        }

        /* Button glow effect */
        .btn-glow {
            position: relative;
            overflow: hidden;
        }

        .btn-glow::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn-glow:hover::before {
            width: 300px;
            height: 300px;
        }

        /* Icon pulse */
        .pulse-icon {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.8;
                transform: scale(1.05);
            }
        }

        /* Relative positioning for content */
        .relative-content {
            position: relative;
            z-index: 10;
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Floating particles -->
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>

    <!-- Header -->
    <header class="glass border-b border-white/20 shadow-xl sticky top-0 z-50 relative-content">
        <div class="max-w-7xl mx-auto px-4 py-5 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <img src="../../logo.jpeg" alt="AlumNetics" class="w-12 h-12 rounded-xl object-cover shadow-2xl ring-2 ring-white/50 hover:scale-110 transition-transform duration-300" />
                <span class="text-2xl font-extrabold gradient-text">ALUMNETICS</span>
            </div>
            <button onclick="goBack()" class="px-6 py-2.5 text-sm font-semibold bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-xl hover:from-purple-700 hover:to-blue-700 transition-all shadow-lg hover:shadow-xl transform hover:scale-105">
                ‚Üê Back to Dashboard
            </button>
        </div>
    </header>

    <!-- Loading State -->
    <div id="loadingState" class="max-w-4xl mx-auto px-4 py-8 text-center relative-content">
        <div class="glass rounded-2xl p-10 shadow-2xl hover-lift">
            <div class="relative">
                <div class="animate-spin rounded-full h-16 w-16 border-b-4 border-t-4 border-purple-600 mx-auto mb-4"></div>
                <div class="absolute top-0 left-1/2 transform -translate-x-1/2 animate-ping rounded-full h-16 w-16 border-4 border-purple-400 opacity-20"></div>
            </div>
            <p class="text-gray-700 text-lg font-semibold shimmer">Loading profile...</p>
            <p class="text-gray-500 text-xs mt-2">Please wait while we fetch the details</p>
        </div>
    </div>

    <!-- Error State -->
    <div id="errorState" class="hidden max-w-4xl mx-auto px-4 py-8 text-center relative-content">
        <div class="glass rounded-2xl p-8 shadow-2xl hover-lift">
            <div class="text-5xl mb-4 animate-bounce">üòï</div>
            <p class="text-red-600 font-extrabold text-xl mb-2" id="errorMessage">User not found</p>
            <p class="text-gray-600 text-sm mb-6">The profile you're looking for doesn't exist or has been removed.</p>
            <button onclick="goBack()" class="px-6 py-3 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-xl hover:from-purple-700 hover:to-blue-700 font-semibold shadow-xl transform hover:scale-105 transition-all btn-glow">
                Go Back to Dashboard
            </button>
        </div>
    </div>

    <!-- Profile Content -->
    <main id="profileContent" class="hidden max-w-6xl mx-auto px-4 py-6 space-y-6 relative-content">
        <!-- Profile Header Card -->
        <div class="glass rounded-2xl shadow-2xl p-6 border border-white/20 hover-lift animate-fadeIn">
            <div class="flex flex-col md:flex-row items-center md:items-start gap-6">
                <!-- Avatar -->
                <div class="relative group">
                    <div class="w-24 h-24 rounded-full bg-gradient-to-br from-purple-500 via-blue-600 to-pink-500 flex items-center justify-center text-white text-3xl font-bold shadow-2xl ring-4 ring-white group-hover:ring-purple-300 transition-all duration-300 transform group-hover:scale-105" id="userAvatar">
                        U
                    </div>
                    <div class="absolute -bottom-1 -right-1 bg-gradient-to-r from-green-400 to-emerald-500 text-white text-[10px] px-2 py-1 rounded-full shadow-lg border-2 border-white font-semibold pulse-icon">
                        ‚úì Active
                    </div>
                </div>
                
                <!-- User Info -->
                <div class="flex-1 text-center md:text-left">
                    <h1 class="text-3xl font-extrabold text-gray-900 mb-2 gradient-text" id="userName">Loading...</h1>
                    <p class="text-lg text-gray-700 mb-4">
                        <span id="userRole" class="font-bold bg-gradient-to-r from-purple-600 to-blue-600 bg-clip-text text-transparent">Student</span>
                    </p>
                    
                    <!-- Badges -->
                    <div class="flex flex-wrap gap-2 justify-center md:justify-start mb-4">
                        <span class="badge-float px-3 py-1.5 bg-gradient-to-r from-purple-100 to-blue-100 text-purple-800 rounded-full text-xs font-bold shadow-lg hover:shadow-xl transition-all transform hover:scale-105 border border-purple-200" id="userDepartment">
                            üìö Department
                        </span>
                        <span class="badge-float px-3 py-1.5 bg-gradient-to-r from-blue-100 to-cyan-100 text-blue-800 rounded-full text-xs font-bold shadow-lg hover:shadow-xl transition-all transform hover:scale-105 border border-blue-200" id="userInstitution" style="animation-delay: 0.5s;">
                            üéì Institution
                        </span>
                        <span class="badge-float px-3 py-1.5 bg-gradient-to-r from-green-100 to-emerald-100 text-green-800 rounded-full text-xs font-bold shadow-lg hover:shadow-xl transition-all transform hover:scale-105 border border-green-200" id="userYear" style="animation-delay: 1s;">
                            üìÖ Class of 2024
                        </span>
                    </div>

                    <!-- Bio -->
                    <div class="glass rounded-xl p-3 shadow-inner">
                        <p class="text-gray-700 text-sm leading-relaxed" id="userBio">No bio available</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Contact & Details Grid -->
        <div class="grid md:grid-cols-2 gap-5">
            <!-- Contact Information -->
            <div class="glass rounded-2xl shadow-2xl p-5 border border-white/20 hover-lift">
                <h2 class="text-xl font-extrabold text-gray-900 mb-4 flex items-center gap-2">
                    <span class="text-2xl pulse-icon">üìß</span> 
                    <span class="gradient-text">Contact Information</span>
                </h2>
                <div class="space-y-3">
                    <!-- Email - Always show field -->
                    <div class="flex items-center gap-3 p-3 bg-gradient-to-r from-purple-50 to-blue-50 rounded-xl border border-purple-200 shadow-md hover:shadow-lg transition-all hover-lift">
                        <div class="w-10 h-10 bg-gradient-to-br from-purple-500 to-blue-600 rounded-lg flex items-center justify-center shadow-lg flex-shrink-0">
                            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                            </svg>
                        </div>
                        <div class="flex-1 min-w-0">
                            <p class="text-[10px] text-gray-600 font-bold uppercase tracking-wide mb-0.5">Email Address</p>
                            <span class="text-gray-800 font-semibold text-sm truncate block" id="userEmail">email@example.com</span>
                        </div>
                    </div>
                    
                    <!-- Phone - Always show field -->
                    <div class="flex items-center gap-3 p-3 bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl border border-green-200 shadow-md hover:shadow-lg transition-all hover-lift" id="phoneContainer">
                        <div class="w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-600 rounded-lg flex items-center justify-center shadow-lg flex-shrink-0">
                            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                            </svg>
                        </div>
                        <div class="flex-1 min-w-0">
                            <p class="text-[10px] text-gray-600 font-bold uppercase tracking-wide mb-0.5">Phone Number</p>
                            <span class="text-gray-800 font-semibold text-sm truncate block" id="userPhone">+91-1234567890</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Academic Details -->
            <div class="glass rounded-2xl shadow-2xl p-5 border border-white/20 hover-lift">
                <h2 class="text-xl font-extrabold text-gray-900 mb-4 flex items-center gap-2">
                    <span class="text-2xl pulse-icon">üéì</span> 
                    <span class="gradient-text">Academic Details</span>
                </h2>
                <div class="space-y-3">
                    <div class="p-3 bg-gradient-to-r from-amber-50 to-orange-50 rounded-xl border border-amber-200 shadow-md hover:shadow-lg transition-all hover-lift">
                        <p class="text-[10px] text-gray-600 font-bold uppercase tracking-wide mb-0.5">Degree Program</p>
                        <p class="text-gray-900 font-bold text-sm" id="userDegree">-</p>
                    </div>
                    <div class="p-3 bg-gradient-to-r from-blue-50 to-cyan-50 rounded-xl border border-blue-200 shadow-md hover:shadow-lg transition-all hover-lift">
                        <p class="text-[10px] text-gray-600 font-bold uppercase tracking-wide mb-0.5">Graduation Year</p>
                        <p class="text-gray-900 font-bold text-sm" id="userGradYear">-</p>
                    </div>
                    <div class="p-3 bg-gradient-to-r from-pink-50 to-rose-50 rounded-xl border border-pink-200 shadow-md hover:shadow-lg transition-all hover-lift">
                        <p class="text-[10px] text-gray-600 font-bold uppercase tracking-wide mb-0.5">Location</p>
                        <p class="text-gray-900 font-bold text-sm" id="userLocation">-</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex flex-wrap gap-4 justify-center pb-6">
            <button id="editProfileBtn" onclick="editProfile()" class="hidden group px-6 py-3 bg-gradient-to-r from-green-600 via-emerald-600 to-teal-600 text-white rounded-xl font-bold text-sm hover:from-green-700 hover:via-emerald-700 hover:to-teal-700 transition-all shadow-xl hover:shadow-2xl transform hover:scale-105 btn-glow relative overflow-hidden">
                <span class="relative z-10 flex items-center gap-2">
                    ‚úèÔ∏è Edit Profile
                    <svg class="w-4 h-4 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                    </svg>
                </span>
            </button>
            <button id="messageBtn" onclick="sendMessage()" class="group px-6 py-3 bg-gradient-to-r from-purple-600 via-blue-600 to-indigo-600 text-white rounded-xl font-bold text-sm hover:from-purple-700 hover:via-blue-700 hover:to-indigo-700 transition-all shadow-xl hover:shadow-2xl transform hover:scale-105 btn-glow relative overflow-hidden">
                <span class="relative z-10 flex items-center gap-2">
                    üí¨ Send Message
                    <svg class="w-4 h-4 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"/>
                    </svg>
                </span>
            </button>
            <button onclick="goBack()" class="px-6 py-3 glass text-gray-800 rounded-xl font-bold text-sm hover:bg-white transition-all shadow-lg border-2 border-white/40 transform hover:scale-105 hover:shadow-xl">
                ‚Üê Back to Search
            </button>
        </div>
    </main>

    <script src="../../assets/js/api-service.js"></script>
    <script>
        let currentUserId = null;

        async function loadUserProfile() {
            console.log('üîç Starting loadUserProfile function...');
            
            // Wait for API to be ready
            let retries = 0;
            while (!window.AlumNeticsAPI && retries < 10) {
                console.log(`‚è≥ Waiting for AlumNeticsAPI... (${retries}/10)`);
                await new Promise(resolve => setTimeout(resolve, 100));
                retries++;
            }
            
            if (!window.AlumNeticsAPI) {
                console.error('‚ùå AlumNeticsAPI failed to load');
                showError('Failed to load API service');
                return;
            }
            
            console.log('‚úÖ AlumNeticsAPI loaded successfully');
            
            try {
                // Get user ID from URL
                const urlParams = new URLSearchParams(window.location.search);
                currentUserId = urlParams.get('id');
                console.log('üîó URL param id:', currentUserId);
                
                // FALLBACK 1: Check sessionStorage if URL param is missing
                if (!currentUserId) {
                    currentUserId = sessionStorage.getItem('viewingUserId');
                    
                    if (currentUserId) {
                        // Update URL to include the ID (for bookmarking/sharing)
                        const newUrl = `${window.location.pathname}?id=${encodeURIComponent(currentUserId)}`;
                        window.history.replaceState({}, '', newUrl);
                    }
                }

                // FALLBACK 2: Load current logged-in user's profile
                if (!currentUserId) {
                    console.log('üîÑ No URL param, checking logged-in user...');
                    
                    // Try multiple ways to get current user
                    let currentUser = null;
                    
                    // Method 1: Use API if available
                    if (window.AlumNeticsAPI && typeof window.AlumNeticsAPI.getCurrentUser === 'function') {
                        currentUser = window.AlumNeticsAPI.getCurrentUser();
                        console.log('üìã Method 1 - API getCurrentUser():', currentUser);
                    }
                    
                    // Method 2: Direct localStorage access
                    if (!currentUser) {
                        const userDataString = localStorage.getItem('userData');
                        if (userDataString) {
                            try {
                                currentUser = JSON.parse(userDataString);
                                console.log('üíæ Method 2 - Direct localStorage:', currentUser);
                            } catch (e) {
                                console.error('‚ùå Failed to parse userData from localStorage:', e);
                            }
                        }
                    }
                    
                    if (currentUser) {
                        // Try different ID field names
                        currentUserId = currentUser._id || currentUser.id || currentUser.userId;
                        console.log('üÜî Extracted user ID:', currentUserId);
                        
                        if (currentUserId) {
                            console.log('‚úÖ Loading current user profile:', currentUserId);
                            // Update URL to include the ID
                            const newUrl = `${window.location.pathname}?id=${encodeURIComponent(currentUserId)}`;
                            window.history.replaceState({}, '', newUrl);
                        } else {
                            console.error('‚ùå User object found but no ID field');
                            console.error('Available fields:', Object.keys(currentUser));
                        }
                    } else {
                        console.log('‚ùå No current user found in any method');
                    }
                }

                if (!currentUserId) {
                    console.error('‚ùå Failed to get user ID from all sources');
                    console.error('  - URL param: none');
                    console.error('  - sessionStorage: none');
                    console.error('  - localStorage (current user): none');
                    
                    // Check if user is actually logged in
                    const token = localStorage.getItem('authToken');
                    const userData = localStorage.getItem('userData');
                    console.error('üîê Auth token exists:', !!token);
                    console.error('üë§ User data exists:', !!userData);
                    
                    if (!token) {
                        showError('Please login to view your profile');
                        setTimeout(() => {
                            window.location.href = '../auth/login.html';
                        }, 2000);
                    } else {
                        showError('Unable to load profile. Please try logging in again.');
                        // Don't redirect immediately, let user see the error
                    }
                    return;
                }

                console.log('üéØ Final user ID to load:', currentUserId);

                // Fetch user data from API
                const response = await window.AlumNeticsAPI.makeRequest('GET', `/users/${currentUserId}`);
                console.log('üì° API response:', response);

                if (response.success && response.data && response.data.user) {
                    const user = response.data.user;
                    
                    // Check if profile is private/hidden (only for other users' profiles)
                    const currentUser = window.AlumNeticsAPI.getCurrentUser();
                    const isOwnProfile = currentUser && currentUser._id === user._id;
                    
                    if (!isOwnProfile && user.privacy && user.privacy.showProfile === false) {
                        showError('This profile is private');
                        return;
                    }
                    
                    displayUserProfile(user);
                } else {
                    console.error('User not found in response');
                    showError('User not found');
                }
            } catch (error) {
                console.error('Error loading profile:', error);
                showError('Failed to load user profile: ' + error.message);
            }
        }

        function displayUserProfile(user) {
            
            // Hide loading, show content
            document.getElementById('loadingState').classList.add('hidden');
            document.getElementById('profileContent').classList.remove('hidden');

            // Check if this is the current user's own profile
            const currentUser = window.AlumNeticsAPI.getCurrentUser();
            const isOwnProfile = currentUser && currentUser._id === user._id;
            
            // Show/hide buttons based on whether it's own profile
            if (isOwnProfile) {
                document.getElementById('editProfileBtn').classList.remove('hidden');
                document.getElementById('messageBtn').classList.add('hidden');
            } else {
                document.getElementById('editProfileBtn').classList.add('hidden');
                document.getElementById('messageBtn').classList.remove('hidden');
            }

            // Update avatar
            const initials = (user.fullName || user.firstName || 'U').substring(0, 2).toUpperCase();
            document.getElementById('userAvatar').textContent = initials;

            // Update basic info
            document.getElementById('userName').textContent = user.fullName || user.firstName + ' ' + (user.lastName || '') || 'Unknown User';
            document.getElementById('userRole').textContent = (user.role || 'student').charAt(0).toUpperCase() + (user.role || 'student').slice(1);
            document.getElementById('userDepartment').textContent = user.department || 'N/A';
            document.getElementById('userInstitution').textContent = user.institution?.name || 'N/A';
            document.getElementById('userYear').textContent = user.graduationYear ? `Class of ${user.graduationYear}` : 'N/A';
            document.getElementById('userBio').textContent = user.bio || 'No bio available';

            // Update contact info based on privacy settings
            const privacy = user.privacy || {};
            
            // Email - Always show the field, but hide value if privacy is off
            if (privacy.showEmail === true && user.email) {
                document.getElementById('userEmail').textContent = user.email;
                document.getElementById('userEmail').classList.remove('text-gray-400', 'italic');
            } else {
                document.getElementById('userEmail').textContent = 'üîí Hidden by user';
                document.getElementById('userEmail').classList.add('text-gray-400', 'italic');
            }

            // Phone - Always show the field, but hide value if privacy is off
            if (privacy.showPhone === true && user.phone) {
                document.getElementById('userPhone').textContent = user.phone;
                document.getElementById('userPhone').classList.remove('text-gray-400', 'italic');
            } else {
                document.getElementById('userPhone').textContent = 'üîí Hidden by user';
                document.getElementById('userPhone').classList.add('text-gray-400', 'italic');
            }

            // Update additional info
            document.getElementById('userDegree').textContent = user.degree || 'Not specified';
            document.getElementById('userGradYear').textContent = user.graduationYear || 'Not specified';
            document.getElementById('userLocation').textContent = user.location || 'Not specified';

            // Update page title
            document.title = `${user.fullName || 'User'} - ALUMNETICS`;
        }

        function showError(message) {
            document.getElementById('loadingState').classList.add('hidden');
            document.getElementById('errorState').classList.remove('hidden');
            document.getElementById('errorMessage').textContent = message;
        }

        function goBack() {
            window.history.back();
        }

        function sendMessage() {
            alert('Messaging feature coming soon!');
        }

        function editProfile() {
            // Check if edit profile page exists, otherwise redirect to dashboard
            const currentUser = window.AlumNeticsAPI.getCurrentUser();
            if (currentUser) {
                if (currentUser.role === 'admin') {
                    // Redirect to admin dashboard with edit mode
                    window.location.href = '../dashboard/admin-dashboard-fixed.html?edit=profile';
                } else if (currentUser.role === 'student') {
                    // Check if student profile edit page exists
                    window.location.href = '../dashboard/student-profile.html';
                } else {
                    // Generic edit - for now, show alert
                    alert('Profile editing feature is coming soon! You can update your profile from the dashboard.');
                    goBack();
                }
            } else {
                alert('Please login to edit your profile');
                window.location.href = '../auth/login.html';
            }
        }

        // Load profile on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ DOM loaded, starting profile load...');
            loadUserProfile();
        });
        
        // Fallback if DOMContentLoaded already fired
        if (document.readyState === 'complete' || document.readyState === 'interactive') {
            console.log('üöÄ DOM already ready, starting profile load...');
            setTimeout(loadUserProfile, 100);
        }
    </script>
</body>
</html>
